<!doctype html>
<html>
<head>
  <title>Freeflow Dual Job Viewer</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
    }
    .container {
      display: flex;
      height: 100vh;
    }
    .map-container {
      display: flex;
      flex-direction: column;
    }
    .left-map {
      width: 30%;
    }
    .right-map {
      width: 70%;
    }
    .map-title {
      background: #333;
      color: white;
      padding: 10px;
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .map-title button {
      background: white;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      font-size: 14px;
      border-radius: 4px;
    }
    .map-title button:hover {
      background: #ddd;
    }
    .map {
      flex: 1;
      width: 100%;
    }
    .divider {
      width: 10px;
      background: white;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="map-container left-map">
      <div class="map-title">Freeflow Houston, TX <button onclick="resetMap('houston')">Reset</button></div>
      <div id="houston-map" class="map"></div>
    </div>
    <div class="divider"></div>
    <div class="map-container right-map">
      <div class="map-title">Freeflow Northeast <button onclick="resetMap('northeast')">Reset</button></div>
      <div id="northeast-map" class="map"></div>
    </div>
  </div>
  
  <script>
    let houstonMap, northeastMap, jobData = [], vehicleData = [], unscheduledJobData = [];

    function initMaps() {
      const houstonCenter = { lat: 29.842052, lng: -95.439373 };
      const northeastCenter = { lat: 42.182020, lng: -72.515020 };

      houstonMap = new google.maps.Map(document.getElementById("houston-map"), {
        zoom: 7,
        center: houstonCenter,
        disableDefaultUI: false,
      });

      northeastMap = new google.maps.Map(document.getElementById("northeast-map"), {
        zoom: 7,
        center: northeastCenter,
        disableDefaultUI: false,
      });

      fetchAllData();
    }

    function fetchAllData() {
      fetchJobData();
      fetchVehicleData();
      fetchUnscheduledJobData();
    }

    function fetchJobData() {
      fetch("https://hook.us1.make.com/0ovk9hp1ev25shv9nampbn1ulhgscj4p")
        .then(response => response.json())
        .then(data => {
          jobData = data;
          addMarkersToMap(houstonMap, jobData, "job");
          addMarkersToMap(northeastMap, jobData, "job");
        })
        .catch(error => console.error("Error fetching job data:", error));
    }

    function fetchVehicleData() {
      fetch("https://motive-vehicles.daniel-ff2.workers.dev/")
        .then(response => response.json())
        .then(data => {
          vehicleData = data.vehicles;
          addMarkersToMap(houstonMap, vehicleData, "vehicle");
          addMarkersToMap(northeastMap, vehicleData, "vehicle");
        })
        .catch(error => console.error("Error fetching vehicle data:", error));
    }

    function fetchUnscheduledJobData() {
      fetch("https://hook.us1.make.com/yy2w2a4cw2rcevdmjx0d9hvw4bcefko4")
        .then(response => response.json())
        .then(data => {
          unscheduledJobData = data;
          addMarkersToMap(houstonMap, unscheduledJobData, "unscheduled");
          addMarkersToMap(northeastMap, unscheduledJobData, "unscheduled");
        })
        .catch(error => console.error("Error fetching unscheduled job data:", error));
    }

    function addMarkersToMap(map, data, type) {
      data.forEach(item => {
        let position = { lat: item.Lat || item.current_location.lat, lng: item.Lng || item.current_location.lon };
        let title = type === "job" ? `Job ${item.JobID} - ${item.LocationName}` :
                    type === "vehicle" ? `Vehicle ${item.vehicle.number}` :
                    `Unscheduled Job ${item.JobID}`;

        const marker = new google.maps.Marker({
          position,
          map,
          title
        });
      });
    }

    function resetMap(target) {
      if (target === 'houston') {
        houstonMap.setCenter({ lat: 29.842052, lng: -95.439373 });
        houstonMap.setZoom(7);
      } else {
        northeastMap.setCenter({ lat: 42.182020, lng: -72.515020 });
        northeastMap.setZoom(7);
      }
    }
  </script>
  
  <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC-qJKroH3C4kpTx2coecp-CZ6tTnzYhXA&callback=initMaps"></script>
</body>
</html>
